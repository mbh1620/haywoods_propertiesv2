<% include ./partials/header.ejs %>

  <head>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.5.1/dist/leaflet.css"
      integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ=="
      crossorigin="" />
  </head>

  <script src="https://unpkg.com/leaflet@1.5.1/dist/leaflet.js"
    integrity="sha512-GffPMF3RvMeYyc1LWMHtK8EbPv0iNZ8/oTtHPx9/cc2ILxQ+u905qIwdpULaqDkyBKgOaB57QTMg7ztg8Jm2Og=="
    crossorigin=""></script>

  <div class="jumbotron w-75" style="margin: 0 auto;padding-bottom:30px">
    <div class="container">
      <h1 style="margin-bottom:50px;font-family: Helvetica, sans-serif;">
        <%= property.name %>
      </h1>


      <div class="container">
        <div id="carouselExampleControls" class="carousel slide" data-ride="carousel"
          style="width:100%;height:660px;margin:0 auto;overflow:hidden">
          <div class="carousel-inner">
            <!-- This section needs to be a foreach for each photo in the directory -->
            <% images.forEach(function(image, index){ %>
              <div id="<%= index %>" class="carousel-item">
                <img src="../uploads/<%= property._id %>/<%= image %>" style="width:100%;height:auto;"
                  class="d-block w-100" alt="...">
              </div>
              <% }) %>
                <script>
                  document.getElementById("0").classList.add("active");
                </script>

          </div>
          <a class="carousel-control-prev" href="#carouselExampleControls" role="button" data-slide="prev">
            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
            <span class="sr-only">Previous</span>
          </a>
          <a class="carousel-control-next" href="#carouselExampleControls" role="button" data-slide="next">
            <span class="carousel-control-next-icon" aria-hidden="true"></span>
            <span class="sr-only">Next</span>
          </a>
        </div>
        <div class="jumbotron bg-white" style="margin-top:50px;padding-top:20px;height:auto">
          <p style="margin-top:20px;">This was listed by: <em>
              <%= property.author.username %>
            </em></p>
          <p style="margin-top:20px;">Price: £<%= property.price %> pcm</p>
          <p style="margin-top:20px;">Location:</p>

          <div id="mapid"
            style="float:left;height:400px;width:400px; display:block; margin-right:20px; margin-bottom:20px;"></div>
          <p style="display:block;white-space: pre-wrap;">
            <%= property.description %>
          </p>
          </br clear="left">
          <div id="button-container" style="display:inline-block;width:400px; height:250px">


            <!-- Add logic for displaying edit and delete buttons here -->
            <% if (currentUser){ %>
              <% if (currentUser.id==property.author.id) { %>
                <a href="/properties/<%= property._id %>/edit" style="float:left" class="btn btn-warning">Edit</a>
                <a href="/user/<%=currentUser._id %>/manage/<%= property._id %>" style="float:left"
                  class="btn btn-primary">Manage</a>
                <form action="/properties/<%= property._id %>?_method=DELETE" style="float:left" method="POST"
                  id="deleteForm">
                  <input type="button" style="display:inline-block" class="btn btn-danger" onclick="deleteProperty()"
                    value="Delete">
                </form>
                <% }else { %>
                  <a style="" href="/properties/<%= property._id %>/enquire" class="btn btn-primary">Enquire about
                    property</a>
                  <% }} %>
                    <a style="display:inline-block;" href="/properties" class="btn btn-danger">Back</a>
          </div>

          <p>Contact Details:</p>
          <p>
            <%= property.author.username %>
          </p>

        </div>
      </div>
    </div>
  </div>

  <script>
    var mymap = L.map('mapid').setView([<%= property.lat %>, <%= property.long %>], 15);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',

      maxZoom: 18,
      id: 'mapbox.streets',
      accessToken: 'pk.eyJ1IjoibWJoMTYyMCIsImEiOiJjankwb244aWgwNHd1M2dsYWtkd2h2NWdwIn0.74tfwmTddrE7BpzyAA-0hw'
    }).addTo(mymap);

    var marker = L.marker([<%= property.lat %>, <%= property.long %>]).addTo(mymap);

    function deleteProperty() {
      if (confirm("Are you sure you would like to delete this property? All data associated to this property will be removed.")) {
        $('#deleteForm').submit();
      } else {

      }
    }


  </script>

  <% include ./partials/footer.ejs %>